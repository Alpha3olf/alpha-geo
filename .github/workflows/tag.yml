name: auto-tag

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

permissions:
  contents: write

on:
  workflow_dispatch:
    inputs:
      tag:
        description: trigger
        required: true
        default: '0'

jobs:
  new-tag:
    runs-on: "ubuntu-latest"
    outputs:
          ver: ${{ steps.tag.outputs.ver }}
    steps:
      - 
        name: Checkout
        uses: actions/checkout@v3

      - 
        name: Get
        id: tag
        shell: bash
        run: |
          echo ver=$(awk -F ' = ' '$1 ~ /version/ { gsub(/["]/, "", $2); printf("%s",$2) }' Cargo.toml) >> $GITHUB_OUTPUT

      - 
        name: Set
        shell: bash
        run: |
          git tag v${{ steps.tag.outputs.ver }} && git push --tags

  # new-release:
  #   needs: new-tag
  #   runs-on: ubuntu-latest
  #   outputs:
  #         tag: ${{ needs.new-tag.outputs.ver }}
  #   steps:
  #     -
  #       name: Checkout
  #       uses: actions/checkout@v3
  #     - 
  #       name: New release
  #       uses: taiki-e/create-gh-release-action@v1.7.1
  #       with:
  #         ref: refs/tags/v${{ needs.new-tag.outputs.ver }}
  #         token: ${{ secrets.GITHUB_TOKEN }}